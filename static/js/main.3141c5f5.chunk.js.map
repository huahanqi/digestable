{"version":3,"sources":["contexts/simplify-context.js","contexts/visualization-context.js","digestable/clustering/kmeans.js","digestable/compute-relation-web-worker.js","digestable/digestable.js","digestable/clustering/clusterQuantiles.js","digestable/clustering/clusterGap.js","digestable/clustering/groupCategories.js","components/table-wrapper/Footer.js","components/table-wrapper/table-wrapper.js","hooks/use-scroll-hook.js","components/controls/controlPanel.js","components/controls/simplifyControls.js","components/controls/visualizationControls.js","app.js","index.js"],"names":["methods","name","type","transform","initialState","apply","columnType","method","amount","transformBase","unique","rows","reducer","state","action","Math","min","Error","SimplifyContext","createContext","SimplifyProvider","children","useReducer","dispatch","Provider","value","modes","categoryScalingOptions","mode","showLinks","categoryScaling","calculatingRelations","VisualizationContext","VisualizationProvider","calcMeanCentroid","dataSet","start","end","features","length","n","mean","i","push","j","getRandomCentroidsNaiveSharding","dataset","k","numSamples","step","floor","centroids","getRandomCentroids","index","max","centroidsIndex","random","indexOf","centroid","compareCentroids","a","b","shouldStop","oldCentroids","iterations","sameCount","getDistanceSQ","diffs","reduce","r","e","getLabels","labels","c","points","indeces","closestCentroidIndex","prevDistance","distance","getPointsMean","pointList","totalPoints","means","point","val","recalculateCentroids","newCentroid","newCentroidList","centroidGroup","Worker_fn","Worker","digestable","table","d3","linkSvg","allData","data","columns","relations","clustering","applySimplification","simplificationMethod","simplificationAmount","simplificationRows","visualizationMode","isCalculating","missingValues","isMissing","d","includes","dispatcher","dispatcher_calcRel","displayRowNum","isFullData","selection","each","inputData","this","selectAll","join","enter","append","attr","map","forEach","column","values","uniqueValues","Array","from","add","Set","validValues","filter","numeric","isNaN","numbers","sort","isId","extent","maxDigits","significantDigits","counts","getCounts","count","clearSorting","clearClustering","v","initialIndex","isCluster","cluster","pinned","expanded","createData","processData","sortTable","drawTable","Object","entries","log10","log","String","split","n1","n2","abs","d1","d2","clusterColumn","find","v1","v2","sortData","maxCount","clusters","transformValues","base","valueScale","domain","range","pow","removeNull","nullIndex","nullCluster","slice","applyNull","concat","scale","clusterQuantiles","reverse","useNaiveSharding","converged","kmeans","numRows","gaps","gap","unshift","clusterGap","console","clusterNumeric","groupCategories","clusterCategorical","size","row","valid","median","q1","q2","warn","sortColumn","px","paddingX","py","paddingY","showSortButtons","info","th","select","div","nameDiv","text","on","evt","sortByColumn","style","clusterByColumn","call","html","classed","width","node","clientWidth","svg","xScale","rangeRound","bins","bin","yScale","rect","x0","x1","colorScale","bandwidth","drawHeader","top","others","s","topString","othersString","expandedData","insert","maxSize","td","valueDiv","w2","w1","height","source","target","drawBody","applyVisualizationMode","clientHeight","highlight","drawLinks","window","computeRelationWorker","postMessage","onmessage","re","cols","offsetWidth","aspect","offset","getBoundingClientRect","x","nodes","left","right","pos","x2","y","xi","yi","line","curve","opacityScale","widthScale","magnitude","_","arguments","updateLinks","onCalcRel","loadMore","rowNum","parseInt","loadMoreData","fullDataLength","Footer","addrowNum","setAddRowNum","refreshDisplayRowNum","useState","displayRowNumAct","setDisplayRowNumAct","padding","display","justifyContent","position","zIndex","backgroundColor","Form","onSubmit","preventDefault","Row","Col","xs","Text","fontSize","Button","disabled","Control","onChange","TableWrapper","useContext","simplifyDispatch","visualizationDispatch","divRef","useRef","digestableRef","OuterDivRef","setIsFullData","onScroll","callback","scrollType","ticking","current","scrollLeft","requestAnimationFrame","scrollTop","useScrollHook","useEffect","datum","ref","overflow","Header","Card","Body","Subtitle","ControlPanel","title","subtitle","className","Stack","Group","Label","Check","Select","Range","SimplifyControls","label","id","checked","FloatingLabel","VisualizationControls","onShowLinksChange","marginBottom","option","Brand","Navbar","datasets","url","App","setDataset","setData","loading","setLoading","loadData","csvData","URLSearchParams","location","search","get","bg","variant","src","alt","as","sm","accept","file","files","URL","createObjectURL","Container","fluid","Spinner","animation","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.3141c5f5.chunk.js","sourcesContent":["import React, { createContext, useReducer } from 'react';\n\nconst methods = [\n  { name: 'quantiles', type: 'rows' },\n  { name: 'kmeans', type: 'rows' },\n  { name: 'gap', type: 'rows', transform: true },\n  //  { name: 'threshold', type: 'amount' }\n];\n\nconst initialState = {\n  apply: false,\n  columnType: 'numeric',\n  methods: methods,\n  method: methods[0],\n  amount: 0.5,\n  transformBase: 1,\n  unique: 0,\n  rows: 10,\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'setApply':\n      return {\n        ...state,\n        apply: action.apply,\n      };\n\n    case 'setMethod':\n      return {\n        ...state,\n        method: action.method,\n      };\n\n    case 'setAmount':\n      return {\n        ...state,\n        amount: action.amount,\n      };\n\n    case 'setTransformBase':\n      return {\n        ...state,\n        transformBase: action.transformBase,\n      };\n\n    case 'setColumnInfo':\n      return {\n        ...state,\n        columnType: action.columnType,\n        unique: action.unique,\n        rows: Math.min(state.rows, action.unique),\n      };\n\n    case 'setRows':\n      return {\n        ...state,\n        rows: action.rows,\n      };\n\n    default:\n      throw new Error('Invalid simplify context action: ' + action.type);\n  }\n};\n\nexport const SimplifyContext = createContext(initialState);\n\nexport const SimplifyProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  return (\n    <SimplifyContext.Provider value={[state, dispatch]}>\n      {children}\n    </SimplifyContext.Provider>\n  );\n};\n","import React, { createContext, useReducer } from 'react';\n\nconst modes = ['text', 'visualizations', 'both', 'interactive'];\n\nconst categoryScalingOptions = ['row', 'column'];\n\nconst initialState = {\n  modes: modes,\n  mode: modes[0],\n  showLinks: false,\n  categoryScalingOptions: categoryScalingOptions,\n  categoryScaling: categoryScalingOptions[0],\n  calculatingRelations: true,\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'setMode':\n      return {\n        ...state,\n        mode: action.mode,\n      };\n\n    case 'setShowLinks':\n      return {\n        ...state,\n        showLinks: action.showLinks,\n      };\n\n    case 'setCategoryScaling':\n      return {\n        ...state,\n        categoryScaling: action.categoryScaling,\n      };\n\n    case 'setCalculatingRelations':\n      return {\n        ...state,\n        calculatingRelations: action.calculatingRelations,\n      };\n\n    default:\n      throw new Error('Invalid visualization context action: ' + action.type);\n  }\n};\n\nexport const VisualizationContext = createContext(initialState);\n\nexport const VisualizationProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  return (\n    <VisualizationContext.Provider value={[state, dispatch]}>\n      {children}\n    </VisualizationContext.Provider>\n  );\n};\n","// Adapted from https://medium.com/geekculture/implementing-k-means-clustering-from-scratch-in-javascript-13d71fbcb31e\n\nconst MAX_ITERATIONS = 50;\n\nfunction randomBetween(min, max) {\n  return Math.floor(\n    Math.random() * (max - min) + min\n  );\n}\n\nfunction calcMeanCentroid(dataSet, start, end) {\n  const features = dataSet[0].length;\n  const n = end - start;\n  let mean = [];\n  for (let i = 0; i < features; i++) {\n    mean.push(0);\n  }\n  for (let i = start; i < end; i++) {\n    for (let j = 0; j < features; j++) {\n      mean[j] = mean[j] + dataSet[i][j] / n;\n    }\n  }\n  return mean;\n}\n\nfunction getRandomCentroidsNaiveSharding(dataset, k) {\n  // implementation of a variation of naive sharding centroid initialization method\n  // (not using sums or sorting, just dividing into k shards and calc mean)\n  // https://www.kdnuggets.com/2017/03/naive-sharding-centroid-initialization-method.html\n  const numSamples = dataset.length;\n  // Divide dataset into k shards:\n  const step = Math.floor(numSamples / k);\n  const centroids = [];\n  for (let i = 0; i < k; i++) {\n    const start = step * i;\n    let end = step * (i + 1);\n    if (i + 1 === k) {\n      end = numSamples;\n    }\n    centroids.push(calcMeanCentroid(dataset, start, end));\n  }\n  return centroids;\n}\n\nfunction getRandomCentroids(dataset, k) {\n  // selects random points as centroids from the dataset\n  const numSamples = dataset.length;\n  const centroidsIndex = [];\n  let index;\n  while (centroidsIndex.length < k) {\n    index = randomBetween(0, numSamples);\n    if (centroidsIndex.indexOf(index) === -1) {\n      centroidsIndex.push(index);\n    }\n  }\n  const centroids = [];\n  for (let i = 0; i < centroidsIndex.length; i++) {\n    const centroid = [...dataset[centroidsIndex[i]]];\n    centroids.push(centroid);\n  }\n  return centroids;\n}\n\nfunction compareCentroids(a, b) {\n  for (let i = 0; i < a.length; i++) {\n    if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction shouldStop(oldCentroids, centroids, iterations) {\n  if (iterations > MAX_ITERATIONS) {\n    return true;\n  }\n  if (!oldCentroids || !oldCentroids.length) {\n    return false;\n  }\n  let sameCount = true;\n  for (let i = 0; i < centroids.length; i++) {\n    if (!compareCentroids(centroids[i], oldCentroids[i])) {\n      sameCount = false;\n    }\n  }\n  return sameCount;\n}\n\n// Calculate Squared Euclidean Distance\nfunction getDistanceSQ(a, b) {\n  const diffs = [];\n  for (let i = 0; i < a.length; i++) {\n    diffs.push(a[i] - b[i]);\n  }\n  return diffs.reduce((r, e) => (r + (e * e)), 0);\n}\n\n// Returns a label for each piece of data in the dataset. \nfunction getLabels(dataSet, centroids) {\n  // prep data structure:\n  const labels = {};\n  for (let c = 0; c < centroids.length; c++) {\n    labels[c] = {\n      points: [],\n      indeces: [],\n      centroid: centroids[c],\n    };\n  }\n  // For each element in the dataset, choose the closest centroid. \n  // Make that centroid the element's label.\n  for (let i = 0; i < dataSet.length; i++) {\n    const a = dataSet[i];\n    let closestCentroid, closestCentroidIndex, prevDistance;\n    for (let j = 0; j < centroids.length; j++) {\n      let centroid = centroids[j];\n      if (j === 0) {\n        closestCentroid = centroid;\n        closestCentroidIndex = j;\n        prevDistance = getDistanceSQ(a, closestCentroid);\n      } else {\n        // get distance:\n        const distance = getDistanceSQ(a, centroid);\n        if (distance < prevDistance) {\n          prevDistance = distance;\n          closestCentroid = centroid;\n          closestCentroidIndex = j;\n        }\n      }\n    }\n\n    labels[closestCentroidIndex].points.push(a);\n    labels[closestCentroidIndex].indeces.push(i);\n  }\n  return labels;\n}\n\nfunction getPointsMean(pointList) {\n  const totalPoints = pointList.length;\n  const means = [];\n  for (let j = 0; j < pointList[0].length; j++) {\n    means.push(0);\n  }\n  for (let i = 0; i < pointList.length; i++) {\n    const point = pointList[i];\n    for (let j = 0; j < point.length; j++) {\n      const val = point[j];\n      means[j] = means[j] + val / totalPoints;\n    }\n  }\n  return means;\n}\n\nfunction recalculateCentroids(dataSet, labels, k) {\n  // Each centroid is the geometric mean of the points that\n  // have that centroid's label. Important: If a centroid is empty (no points have\n  // that centroid's label) you should randomly re-initialize it.\n  let newCentroid;\n  const newCentroidList = [];\n  for (const k in labels) {\n    const centroidGroup = labels[k];\n    if (centroidGroup.points.length > 0) {\n      // find mean:\n      newCentroid = getPointsMean(centroidGroup.points);\n    } else {\n      // get new random centroid\n      newCentroid = getRandomCentroids(dataSet, 1)[0];\n    }\n    newCentroidList.push(newCentroid);\n  }\n  return newCentroidList;\n}\n\nexport function kmeans(dataset, k, useNaiveSharding = true) {\n  if (dataset.length && dataset[0].length && dataset.length >= k) {\n    // Initialize book keeping variables\n    let iterations = 0;\n    let oldCentroids, labels, centroids;\n\n    // Initialize centroids randomly\n    if (useNaiveSharding) {\n      centroids = getRandomCentroidsNaiveSharding(dataset, k);\n    } else {\n      centroids = getRandomCentroids(dataset, k);\n    }\n\n    // Run the main k-means algorithm\n    while (!shouldStop(oldCentroids, centroids, iterations)) {\n      // Save old centroids for convergence test.\n      oldCentroids = [...centroids];\n      iterations++;\n\n      // Assign labels to each datapoint based on centroids\n      labels = getLabels(dataset, centroids);\n      centroids = recalculateCentroids(dataset, labels, k);\n    }\n\n    const clusters = [];\n    for (let i = 0; i < k; i++) {\n      clusters.push(labels[i]);\n    }\n    const results = {\n      clusters: clusters,\n      centroids: centroids,\n      iterations: iterations,\n      converged: iterations <= MAX_ITERATIONS,\n    };\n    return results;\n  } else {\n    throw new Error('Invalid dataset');\n  }\n}","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/compute-relation-web-worker.39ef6faf.worker.js\");\n}\n","import * as d3 from 'd3';\nimport {\n  clusterQuantiles,\n  kmeans,\n  clusterGap,\n  groupCategories,\n} from './clustering';\nimport './digestable.css';\n// import worker for relation calculation\n/* eslint-disable import/no-webpack-loader-syntax */\nimport Worker from 'worker-loader!./compute-relation-web-worker.js';\n\nexport const digestable = () => {\n  // The table\n  let table = d3.select(),\n    linkSvg = d3.select(),\n    // Data\n    allData = [],\n    data = [],\n    columns = [],\n    relations = [],\n    clustering = false,\n    // Parameters\n    applySimplification = false,\n    simplificationMethod = 'threshold',\n    simplificationAmount = 0.9,\n    simplificationRows = 20,\n    transformBase = 1,\n    visualizationMode = 'text',\n    showLinks = false,\n    // web-worker para\n    isCalculating = false,\n    categoryScaling = 'row',\n    paddingX = 5,\n    paddingY = 0,\n    // Missing data\n    missingValues = ['', 'NA', 'na'],\n    isMissing = (d) => missingValues.includes(d),\n    // Event dispatcher\n    dispatcher = d3.dispatch('clusterByColumn'),\n    dispatcher_calcRel = d3.dispatch('CalculateRelations'),\n    // load more data parameters\n    displayRowNum = 100,\n    isFullData = false;\n\n  function digestable(selection) {\n    selection.each(function(d) {\n      // Create SVG for links\n      linkSvg = d3\n        .select(this)\n        .selectAll('.linkSvg')\n        .data([[]])\n        .join((enter) => enter.append('svg').attr('class', 'linkSvg'));\n\n      // Create skeletal table\n      table = d3\n        .select(this)\n        .selectAll('table')\n        .data([[]])\n        .join((enter) => {\n          const table = enter.append('table');\n\n          table.append('thead').append('tr');\n          table.append('tbody');\n\n          return table;\n        });\n\n      createColumns(d);\n      createData(d);\n      processData();\n      sortTable();\n      drawTable();\n    });\n  }\n\n  // Helper functions\n  const textVisibility = () =>\n    visualizationMode === 'text' || visualizationMode === 'both'\n      ? 'visible'\n      : 'hidden';\n  const visVisibility = () =>\n    visualizationMode !== 'text' ? 'visible' : 'hidden';\n\n  const getCounts = (uniqueValues, values) =>\n    Object.entries(\n      values.reduce(\n        (counts, value) => {\n          counts[value]++;\n          return counts;\n        },\n        uniqueValues.reduce((counts, value) => {\n          counts[value] = 0;\n          return counts;\n        }, {})\n      )\n    )\n      .map(([key, value]) => ({\n        value: key,\n        count: value,\n      }))\n      .sort((a, b) => d3.descending(a.count, b.count));\n\n  const significantDigits = (n) => {\n    const log10 = Math.log(10);\n\n    // Split decimal\n    let [n1, n2] = String(n).split('.');\n\n    // Handle left of decimal\n    n1 = Math.abs(n1);\n    const d1 = Math.floor(Math.log(n) / log10) + 1;\n\n    // Handle right of decimal\n    const d2 = n2\n      ? n1 > 0\n        ? n2.length\n        : Math.floor(Math.log(+n) / log10) + 1\n      : 0;\n\n    return Math.max(d1 + d2, 1);\n  };\n\n  function clearSorting() {\n    columns.forEach((d) => (d.sort = null));\n  }\n\n  function clearClustering() {\n    columns.forEach((d) => (d.cluster = null));\n  }\n\n  function createColumns(inputData) {\n    columns = inputData.columns.map((d) => ({\n      name: d,\n    }));\n\n    // Determine column types and set column info\n    columns.forEach((column) => {\n      const { name } = column;\n      const values = inputData.map((d) => d[name]);\n      const uniqueValues = Array.from(\n        values.reduce((values, d) => values.add(d), new Set())\n      );\n      const validValues = uniqueValues.filter((value) => !isMissing(value));\n      const numeric = validValues.reduce(\n        (numeric, value) => numeric && !isNaN(value),\n        true\n      );\n      const numbers = numeric ? validValues.map((d) => +d) : null;\n\n      column.uniqueValues = uniqueValues;\n\n      if (numeric) {\n        if (numbers.length === inputData.length) {\n          // Heuristic to check for integer ID type\n          numbers.sort((a, b) => d3.ascending(a, b));\n\n          const isId = numbers.reduce(\n            (isId, d, i, a) => isId && (i === 0 || d === a[i - 1] + 1),\n            true\n          );\n\n          column.type = isId ? 'id' : 'numeric';\n        } else if (\n          numbers.length === 2 &&\n          numbers.includes(0) &&\n          numbers.includes(1)\n        ) {\n          // Treat binary as categorical\n          column.type = 'categorical';\n        } else {\n          column.type = 'numeric';\n        }\n      } else if (uniqueValues.length === inputData.length) {\n        column.type = 'id';\n      } else {\n        column.type = 'categorical';\n      }\n\n      if (column.type === 'numeric') {\n        column.values = values.filter((value) => !isMissing(value));\n        column.extent = d3.extent(numbers);\n        column.maxDigits = d3.max(numbers, significantDigits);\n      } else if (column.type === 'categorical') {\n        column.type = 'categorical';\n        column.counts = getCounts(uniqueValues, values).sort(\n          (a, b) => b.count - a.count\n        );\n        column.uniqueValues = column.counts.map(({ value }) => value);\n      }\n    });\n\n    clearSorting();\n    clearClustering();\n  }\n\n  function createData(inputData) {\n    allData = inputData.map((d, i) => {\n      const v = { ...d };\n\n      // Convert missing and numeric data\n      columns.forEach(({ type, name }) => {\n        const value = v[name];\n\n        if (isMissing(value)) {\n          v[name] = null;\n        } else if (type === 'numeric') {\n          v[name] = +value;\n        }\n      });\n\n      return {\n        initialIndex: i,\n        isCluster: false,\n        cluster: null,\n        pinned: false,\n        expanded: false,\n        values: v,\n      };\n    });\n  }\n\n  // function computeRelations() {\n  //   // Compute relations\n  //   relations = columns.reduce((relations, column1, i, a) => {\n  //     const v1 = allData.map((d) => d.values[column1.name]);\n\n  //     for (let j = i + 1; j < a.length; j++) {\n  //       const column2 = a[j];\n  //       const v2 = allData.map((d) => d.values[column2.name]);\n\n  //       const value =\n  //         column1.type === 'id' || column2.type === 'id'\n  //           ? 0\n  //           : column1.type === 'categorical' && column2.type === 'categorical'\n  //           ? cramersV(v1, v2)\n  //           : column1.type === 'categorical' && column2.type === 'numeric'\n  //           ? categoricalRegression(v1, v2)\n  //           : column1.type === 'numeric' && column2.type === 'categorical'\n  //           ? categoricalRegression(v2, v1)\n  //           : correlation(v1, v2);\n\n  //       relations.push({\n  //         source: column1,\n  //         target: column2,\n  //         value: value,\n  //         magnitude: Math.abs(value),\n  //       });\n  //     }\n\n  //     return relations;\n  //   }, []);\n\n  //   relations.sort((a, b) => d3.ascending(a.magnitude, b.magnitude));\n  // }\n\n  function sortByColumn(column) {\n    const sort = column.sort === 'descending' ? 'ascending' : 'descending';\n\n    clearSorting();\n\n    column.sort = sort;\n  }\n\n  function clusterByColumn(column) {\n    const cluster =\n      column.cluster === null\n        ? 'descending'\n        : column.cluster === 'descending'\n        ? 'ascending'\n        : null;\n\n    clearClustering();\n    clearSorting();\n\n    column.cluster = cluster;\n  }\n\n  function sortData() {\n    const clusterColumn = columns.find(({ cluster }) => cluster);\n\n    const sort = clusterColumn ? clusterColumn.cluster : 'ascending';\n\n    allData.sort((a, b) => {\n      const v1 = clusterColumn ? a.values[clusterColumn.name] : a.initialIndex;\n      const v2 = clusterColumn ? b.values[clusterColumn.name] : b.initialIndex;\n\n      return v1 === v2\n        ? 0\n        : v1 === null\n        ? 1\n        : v2 === null\n        ? -1\n        : d3[sort](v1, v2);\n    });\n  }\n\n  function processData() {\n    sortData();\n\n    // Clear expanded\n    allData.forEach((d) => (d.expanded = false));\n\n    const clusterColumn = columns.find(({ cluster }) => cluster);\n\n    // Initialize categorical and id column counts\n    columns\n      .filter(({ type }) => type !== 'numeric')\n      .forEach((column) => (column.maxCount = 1));\n\n    clustering =\n      applySimplification && clusterColumn && clusterColumn.type !== 'id';\n\n    if (clustering) {\n      const { name, type, cluster: sort } = clusterColumn;\n\n      const values = allData.map((d) => d.values[name]);\n\n      const clusters = (type === 'numeric'\n        ? clusterNumeric(values, sort)\n        : clusterCategorical(values)\n      ).filter((cluster) => cluster.length > 0);\n\n      data = clusters.map((cluster) => {\n        const size = cluster.length;\n\n        // No cluster if only 1\n        if (size === 1) {\n          allData[cluster[0]].cluster = null;\n\n          return allData[cluster[0]];\n        }\n\n        // Create row object\n        const row = {\n          isCluster: true,\n          indeces: cluster,\n          size: size,\n          values: {},\n        };\n\n        // Set cluster object for each item\n        cluster.forEach((i) => (allData[i].cluster = row));\n\n        // Compute info based on column type\n        columns.forEach((column) => {\n          const { name, type, uniqueValues } = column;\n\n          if (type === 'numeric') {\n            const values = cluster.map((i) => allData[i].values[name]);\n\n            if (values.length > 0) {\n              const validValues = values.filter((d) => d !== null);\n\n              row.values[name] =\n                validValues.length > 0\n                  ? {\n                      valid: true,\n                      values: values,\n                      validValues: validValues,\n                      min: d3.min(validValues),\n                      max: d3.max(validValues),\n                      median: d3.median(validValues),\n                      q1: d3.quantile(validValues, 0.25),\n                      q2: d3.quantile(validValues, 0.75),\n                    }\n                  : {\n                      valid: false,\n                      values: values,\n                    };\n            } else {\n              row.values[name] = null;\n            }\n          } else if (type === 'categorical') {\n            const values = cluster.map((i) => allData[i].values[name]);\n\n            if (values.length > 0) {\n              const counts = getCounts(uniqueValues, values);\n\n              column.maxCount = Math.max(column.maxCount, counts[0].count);\n\n              row.values[name] = {\n                counts: counts,\n              };\n            } else {\n              row.values[name] = null;\n            }\n          } else if (type === 'id') {\n            const values = cluster.map((i) => allData[i].values[name]);\n\n            if (values.length > 0) {\n              const counts = values.map((value) => ({\n                value: value,\n                count: 1,\n              }));\n\n              row.values[name] = {\n                counts: counts,\n              };\n            } else {\n              row.values[name] = null;\n            }\n          } else {\n            console.warn('Unknown column type: ' + type);\n          }\n        });\n\n        return row;\n      });\n    } else {\n      if (displayRowNum < [...allData].length) {\n        data = [...allData].slice(0, displayRowNum);\n      } else {\n        data = [...allData];\n        isFullData = true;\n      }\n    }\n\n    function clusterNumeric(values, sort) {\n      const transformValues = (values) => {\n        const base = sort === 'ascending' ? 1 / transformBase : transformBase;\n\n        const valueScale = d3\n          .scaleLinear()\n          .domain(d3.extent(values))\n          .range([0, 1]);\n\n        return values.map((d) => Math.pow(valueScale(d), base));\n      };\n\n      const removeNull = (values) => {\n        // Find first null. Always sorted to the end.\n        const nullIndex = values.indexOf(null);\n        const nullCluster =\n          nullIndex > -1 ? d3.range(nullIndex, values.length) : null;\n        const validValues =\n          nullIndex > -1 ? values.slice(0, nullIndex) : values;\n        const rows = nullCluster ? simplificationRows - 1 : simplificationRows;\n\n        return [validValues, nullCluster, rows];\n      };\n\n      const applyNull = (clusters, nullCluster) => {\n        return nullCluster ? clusters.concat([nullCluster]) : clusters;\n      };\n\n      switch (simplificationMethod) {\n        case 'quantiles': {\n          const [validValues, nullCluster, rows] = removeNull(values);\n          const clusters = clusterQuantiles(validValues, rows);\n          if (sort === 'descending') clusters.reverse();\n\n          return applyNull(clusters, nullCluster);\n        }\n\n        case 'kmeans': {\n          const [validValues, nullCluster, rows] = removeNull(values);\n          const { clusters } = kmeans(\n            validValues.map((d) => [d]),\n            rows\n          );\n          clusters.sort((a, b) => d3[sort](a.centroid[0], b.centroid[0]));\n\n          return applyNull(\n            clusters.map((cluster) => cluster.indeces),\n            nullCluster\n          );\n        }\n\n        case 'gap': {\n          const [validValues, nullCluster, rows] = removeNull(values);\n          const clusters = clusterGap(transformValues(validValues), rows);\n\n          return applyNull(clusters, nullCluster);\n        }\n\n        default:\n          console.log(`Unknown simplification method: ${simplificationMethod}`);\n      }\n    }\n\n    function clusterCategorical(values) {\n      return groupCategories(values);\n    }\n  }\n\n  function sortTable() {\n    const sortColumn = columns.find(({ sort }) => sort !== null);\n\n    if (!sortColumn) return;\n\n    const { name, type, sort, cluster } = sortColumn;\n\n    data.sort((a, b) => {\n      switch (type) {\n        case 'numeric': {\n          const v1 = a.isCluster ? a.values[name].median : a.values[name];\n          const v2 = b.isCluster ? b.values[name].median : b.values[name];\n\n          return v1 === v2\n            ? 0\n            : v1 === null\n            ? 1\n            : v2 === null\n            ? -1\n            : d3[sort](v1, v2);\n        }\n\n        case 'categorical': {\n          if (cluster) {\n            const v1 = a.isCluster\n              ? a.values[name].counts[0].count\n              : a.values[name]\n              ? 1\n              : null;\n            const v2 = b.isCluster\n              ? b.values[name].counts[0].count\n              : b.values[name]\n              ? 1\n              : null;\n\n            return v1 === v2\n              ? 0\n              : v1 === null\n              ? 1\n              : v2 === null\n              ? -1\n              : d3[sort](v1, v2);\n          } else {\n            const v1 = a.isCluster\n              ? a.values[name].counts[0].count / a.size\n              : a.values[name];\n            const v2 = b.isCluster\n              ? b.values[name].counts[0].count / b.size\n              : b.values[name];\n\n            return v1 === v2\n              ? 0\n              : v1 === null\n              ? 1\n              : v2 === null\n              ? -1\n              : d3[sort](v1, v2);\n          }\n        }\n\n        case 'id': {\n          const v1 = a.isCluster\n            ? a.values[name].counts[0].value\n            : a.values[name];\n          const v2 = b.isCluster\n            ? b.values[name].counts[0].value\n            : b.values[name];\n\n          return v1 === v2\n            ? 0\n            : v1 === null\n            ? 1\n            : v2 === null\n            ? -1\n            : d3[sort](v1, v2);\n        }\n\n        default:\n          console.log(`Unknown column type ${type}`);\n          return 0;\n      }\n    });\n  }\n\n  function drawTable() {\n    const px = paddingX + 'px';\n    const py = paddingY + 'px';\n\n    const clusterIcon = (cluster) =>\n      cluster === 'ascending' ? '' : cluster === 'descending' ? '' : '';\n    //cluster === 'ascending' ? '' :\n    //cluster === 'descending' ? '' :\n    //''\n\n    const sortIcon = (sort) => (sort === 'ascending' ? '' : '');\n\n    const clusterColumn = columns.find(({ cluster }) => cluster);\n    const showSortButtons =\n      applySimplification &&\n      clusterColumn &&\n      clusterColumn.type === 'categorical';\n\n    // Reset svg widths for proper column width sizing\n    table.selectAll('svg').attr('width', 0);\n\n    drawHeader();\n    drawBody();\n    applyVisualizationMode();\n    highlight();\n    drawLinks();\n\n    function drawHeader() {\n      const info = (column) => {\n        switch (column.type) {\n          case 'numeric': {\n            // Display range and median for clusters\n            const min = column.extent[0];\n            const max = column.extent[1];\n\n            return min === max\n              ? min\n              : `<div class='range'><div>${min}</div><div class='dash'><hr /></div><div>${max}</div>`;\n          }\n\n          case 'categorical': {\n            return `<div>${column.uniqueValues.length} categories</div>`;\n          }\n\n          case 'id': {\n            return `<div>${column.uniqueValues.length} unique values<div>`;\n          }\n\n          default:\n            return null;\n        }\n      };\n\n      // Header elements\n      const th = table\n        .select('thead')\n        .select('tr')\n        .selectAll('th')\n        .data(columns, (d) => d.name)\n        .join((enter) => {\n          const th = enter.append('th');\n\n          const div = th.append('div').attr('class', 'headerDiv');\n\n          const nameDiv = div.append('div').attr('class', 'nameDiv');\n\n          nameDiv.append('div').text((d) => d.name);\n\n          nameDiv\n            .append('button')\n            .attr('class', 'headerButton sortButton')\n            .on('click', (evt, d) => {\n              sortByColumn(d);\n              sortTable();\n              drawTable();\n            });\n\n          nameDiv\n            .append('button')\n            .attr('class', 'headerButton clusterButton')\n            .style('font-weight', 'bold')\n            .on('click', (evt, d) => {\n              clusterByColumn(d);\n              processData();\n              sortTable();\n              drawTable();\n\n              dispatcher.call('clusterByColumn', this, d);\n            });\n\n          div\n            .append('div')\n            .attr('class', 'info')\n            .html(info);\n\n          div.each(function(column) {\n            d3.select(this)\n              .selectAll('.visDiv')\n              .data(column.type === 'id' ? [] : [column])\n              .join((enter) => {\n                const div = enter.append('div').attr('class', 'visDiv');\n\n                div.append('svg');\n\n                return div;\n              });\n          });\n\n          th.append('div').attr('class', 'highlight');\n\n          return th;\n        })\n        .classed('active', (d) => d.cluster !== null)\n        .style('padding-left', px)\n        .style('padding-right', px)\n        .style('padding-top', py)\n        .style('padding-bottom', py);\n\n      // Update buttons\n      th.select('.clusterButton')\n        .classed('active', (d) => d.cluster !== null)\n        .text((d) => clusterIcon(d.cluster));\n\n      th.select('.sortButton')\n        .classed('active', (d) => d.sort !== null)\n        .style('visibility', (d) => (showSortButtons ? null : 'hidden'))\n        .text((d) => sortIcon(d.sort));\n\n      // Separate out the visualization update so we have an accurate width after rendering textual elements\n      table\n        .select('thead')\n        .selectAll('tr')\n        .each(function() {\n          d3.select(this)\n            .selectAll('th')\n            .each(function(column) {\n              const width = d3\n                .select(this)\n                .select('.nameDiv')\n                .node().clientWidth;\n              const height = 10;\n\n              // Visualization\n              switch (column.type) {\n                case 'numeric': {\n                  const svg = d3\n                    .select(this)\n                    .select('.visDiv svg')\n                    .attr('width', width)\n                    .attr('height', height);\n\n                  const xScale = d3\n                    .scaleLinear()\n                    .domain(column.extent)\n                    .rangeRound([0, width]);\n\n                  const bin = d3.bin().domain(xScale.domain());\n\n                  const bins = bin(column.values);\n\n                  const yScale = d3\n                    .scaleLinear()\n                    .domain([0, d3.max(bins, (d) => d.length)])\n                    .range([height, 0]);\n\n                  // Histogram\n                  svg\n                    .selectAll('rect')\n                    .data(bins)\n                    .join((enter) => {\n                      const rect = enter.append('rect').style('fill', '#aaa');\n\n                      rect.append('title');\n\n                      return rect;\n                    })\n                    .attr('x', (d) => xScale(d.x0))\n                    .attr('y', (d) => yScale(d.length))\n                    .attr('width', (d) => xScale(d.x1) - xScale(d.x0) - 1)\n                    .attr('height', (d) => yScale(0) - yScale(d.length))\n                    .select('title')\n                    .text((d) => `${d.x0}-${d.x1}: ${d.length}`);\n\n                  break;\n                }\n\n                case 'categorical': {\n                  const svg = d3\n                    .select(this)\n                    .select('.visDiv svg')\n                    .attr('width', width)\n                    .attr('height', height);\n\n                  const colorScale = d3\n                    .scaleOrdinal()\n                    .domain(column.uniqueValues)\n                    .range(d3.schemeTableau10);\n\n                  const xScale = d3\n                    .scaleBand()\n                    .domain(column.uniqueValues)\n                    .range([0, width]);\n\n                  const yScale = d3\n                    .scaleLinear()\n                    .domain([0, d3.max(column.counts, (d) => d.count)])\n                    .range([height, 0]);\n\n                  // Bars\n                  svg\n                    .selectAll('rect')\n                    .data(column.counts)\n                    .join((enter) => {\n                      const rect = enter.append('rect');\n                      rect.append('title');\n                      return rect;\n                    })\n                    .attr('x', (d) => xScale(d.value))\n                    .attr('y', (d) => yScale(d.count))\n                    .attr('width', xScale.bandwidth())\n                    .attr('height', (d) => yScale(0) - yScale(d.count))\n                    .attr('fill', (d) => colorScale(d.value))\n                    .select('title')\n                    .text((d) => `${d.value}: ${d.count}`);\n\n                  break;\n                }\n\n                case 'id':\n                  d3.select(this)\n                    .select('.visDiv svg')\n                    .attr('width', width)\n                    .attr('height', height);\n\n                  break;\n\n                default:\n                  console.log(`Unknown column type ${column.type}`);\n              }\n            });\n        });\n    }\n\n    function drawBody() {\n      const text = (type, v, isCluster, maxDigits) => {\n        switch (type) {\n          case 'numeric': {\n            if (v !== null && isCluster && v.valid) {\n              // Display range and median for clusters\n              const median = d3.format(`.${maxDigits}r`)(v.median);\n\n              return v.min === v.max\n                ? median\n                : `<div class='range'><div class='extrema'>${v.min}</div><div>${median}</div><div class='extrema'>${v.max}<div>`;\n            } else {\n              return v === null || isCluster ? '' : v;\n            }\n          }\n\n          case 'categorical': {\n            if (v !== null && isCluster) {\n              // Display top category and number of other categories\n              const top = v.counts[0];\n              const others = v.counts.slice(1).filter((d) => d.count > 0);\n              const s = others.map((d) => `${d.value} (${d.count})`).join(', ');\n\n              const topString =\n                `<div>${top.value}` +\n                (top.count > 1 ? ` (${top.count})</div>` : '<div>');\n\n              const othersString =\n                others.length === 1\n                  ? `<div class='others' title=\"${s}\">and 1 other category</div>`\n                  : others.length > 1\n                  ? `<div class='others' title=\"${s}\">and ${others.length} other categories</div>`\n                  : `<div class='others none'>dummy text</div>`;\n\n              return `<div class='categories'>${topString}${othersString}</div>`;\n            } else {\n              return v === null ? '' : v;\n            }\n          }\n\n          case 'id': {\n            if (v !== null && isCluster) {\n              // Display first id and number of other ids\n              const top = v.counts[0];\n              const others = v.counts.slice(1).filter((d) => d.count > 0);\n              const s = others.map((d) => d.value).join(', ');\n\n              const topString = `<div>${top.value}<div>`;\n\n              const othersString =\n                others.length === 1\n                  ? `<div class='others' title=\"${s}\">and 1 other</div>`\n                  : others.length > 1\n                  ? `<div class='others' title=\"${s}\">and ${others.length} others</div>`\n                  : '';\n\n              return `<div class='categories'>${topString}${othersString}</div>`;\n            } else {\n              return v === null ? '' : v;\n            }\n          }\n\n          case 'cluster': {\n            return `<div class='clusterSize'>n = ${v}</div>`;\n          }\n\n          default:\n            return null;\n        }\n      };\n\n      // Insert pinned and expanded rows\n      const expandedData = [];\n\n      const sortColumn = columns.find(({ sort }) => sort !== null);\n      const clusterColumn = columns.find(({ cluster }) => cluster !== null);\n\n      data.forEach((row) => {\n        expandedData.push(row);\n\n        if (row.isCluster) {\n          const insert = row.indeces\n            .map((i) => allData[i])\n            .filter((d) => d.pinned || d.expanded);\n\n          const name = sortColumn ? sortColumn.name : clusterColumn.name;\n          const sort = sortColumn ? sortColumn.sort : clusterColumn.cluster;\n\n          insert.sort((a, b) => {\n            const v1 = a.values[name];\n            const v2 = b.values[name];\n\n            return v1 === null && v2 === null\n              ? 0\n              : v1 === null\n              ? 1\n              : v2 === null\n              ? -1\n              : d3[sort](v1, v2);\n          });\n\n          expandedData.push(...insert);\n        }\n      });\n\n      const maxSize = d3.max(data, (d) => (d.isCluster ? d.size : 1));\n\n      table\n        .select('tbody')\n        .selectAll('tr')\n        .data(expandedData)\n        .join('tr')\n        //.style('cursor', d => d.isCluster ? allData[d.indeces[0]].expanded ? 'zoom-out' : 'zoom-in': 'pointer')\n        .style('cursor', 'pointer')\n        .each(function(d) {\n          d3.select(this)\n            .selectAll('td')\n            .data(columns, (d) => d.name)\n            .join((enter) => {\n              const td = enter.append('td');\n\n              const div = td.append('div').attr('class', 'cellDiv');\n\n              const valueDiv = div.append('div').attr('class', 'valueDiv');\n\n              valueDiv\n                .append('div')\n                .attr('class', 'textDiv')\n                .classed('notId', (d) => d.type !== 'id')\n                .style('text-align', (d) =>\n                  d.type === 'numeric' ? 'center' : 'left'\n                );\n\n              valueDiv.append('div').attr('class', 'visDiv');\n\n              return td;\n            })\n            .classed('active', (d) => d.cluster !== null)\n            .style('padding-left', px)\n            .style('padding-right', px)\n            .style('padding-top', py)\n            .style('padding-bottom', py)\n            .each(function(column) {\n              // Text\n              const v = d.values[column.name];\n\n              const td = d3\n                .select(this)\n                .classed('expanded', d.expanded)\n                .classed('pinned', d.pinned);\n\n              td.select('.valueDiv .textDiv').html(\n                text(column.type, v, d.isCluster, column.maxDigits)\n              );\n\n              td.select('.cellDiv')\n                .selectAll('.clusterDiv')\n                .data(clustering && column.cluster !== null ? [v] : [])\n                .join((enter) => {\n                  const div = enter.append('div').attr('class', 'clusterDiv');\n\n                  div.append('div').attr('class', 'textDiv notId');\n\n                  div.append('div').attr('class', 'visDiv');\n\n                  return div;\n                })\n                .select('.textDiv')\n                .html(\n                  d.expanded ? '' : text('cluster', d.isCluster ? d.size : 1)\n                );\n            });\n        });\n\n      // Separate out the visualization update so we have an accurate width after rendering textual elements\n      table\n        .select('tbody')\n        .selectAll('tr')\n        .each(function(d, i) {\n          d3.select(this)\n            .selectAll('td')\n            .each(function(column) {\n              // Get column width\n              if (i === 0) {\n                column.width = d3\n                  .select(this)\n                  .select('.valueDiv')\n                  .node().clientWidth;\n              }\n\n              const v = d.values[column.name];\n\n              const height = 10;\n\n              // Visualization\n              switch (column.type) {\n                case 'numeric':\n                  d3.select(this)\n                    .select('.valueDiv .visDiv')\n                    .selectAll('svg')\n                    .data(v === null || (d.isCluster && !v.valid) ? [] : [v])\n                    .join('svg')\n                    .attr('width', column.width)\n                    .attr('height', height)\n                    .each(function(v) {\n                      const svg = d3.select(this);\n\n                      const height = 6;\n                      const y = height / 2;\n                      const r = height / 2;\n                      const w1 = r;\n                      const w2 = Math.max(Math.floor(w1 / 2), 1);\n\n                      const colorScale = d3\n                        .scaleLinear()\n                        .domain([\n                          column.extent[0],\n                          (column.extent[0] + column.extent[1]) / 2,\n                          column.extent[1],\n                        ])\n                        .range(['#2171b5', '#999', '#cb181d']);\n\n                      const xScale = d3\n                        .scaleLinear()\n                        .domain(column.extent)\n                        .range([r, column.width - r]);\n\n                      // Quartile line\n                      svg\n                        .selectAll('line')\n                        .data(\n                          d.isCluster\n                            ? [\n                                [v.min, v.max, v.median],\n                                [v.q1, v.q2, v.median],\n                              ]\n                            : []\n                        )\n                        .join((enter) =>\n                          enter\n                            .append('line')\n                            .style('margin', 0)\n                            .style('padding', 0)\n                            .style('stroke-linecap', 'round')\n                        )\n                        .attr('x1', (d) => xScale(d[0]))\n                        .attr('y1', y)\n                        .attr('x2', (d) => xScale(d[1]))\n                        .attr('y2', y)\n                        .style('stroke', (d) => colorScale(d[2]))\n                        .style('stroke-width', (d, i) => (i === 0 ? w2 : w1));\n\n                      // Median\n                      svg\n                        .selectAll('circle')\n                        .data(d.isCluster ? [v.median] : [v])\n                        .join('circle')\n                        .attr('cx', (d) => xScale(d))\n                        .attr('cy', y)\n                        .attr('r', r)\n                        .style('fill', (d) => colorScale(d));\n                    });\n\n                  break;\n\n                case 'categorical':\n                  d3.select(this)\n                    .select('.valueDiv .visDiv')\n                    .selectAll('svg')\n                    .data(v === null ? [] : [v])\n                    .join('svg')\n                    .attr('width', column.width)\n                    .attr('height', height)\n                    .each(function(v) {\n                      const svg = d3.select(this);\n\n                      const height = 10;\n\n                      const counts = v.counts\n                        ? v.counts\n                        : [\n                            {\n                              value: v,\n                              count: 1,\n                            },\n                          ];\n\n                      const colorScale = d3\n                        .scaleOrdinal()\n                        .domain(column.uniqueValues)\n                        .range(d3.schemeTableau10);\n\n                      const xScale = d3\n                        .scaleBand()\n                        .domain(column.uniqueValues)\n                        .range([0, column.width]);\n\n                      const yScale = d3\n                        .scaleLinear()\n                        .domain(\n                          categoryScaling === 'row'\n                            ? [0, d3.max(counts, (d) => d.count)]\n                            : [0, column.maxCount]\n                        )\n                        .range([height, 0]);\n\n                      // Bars\n                      svg\n                        .selectAll('rect')\n                        .data(counts)\n                        .join((enter) => {\n                          const rect = enter.append('rect');\n                          rect.append('title');\n                          return rect;\n                        })\n                        .attr('x', (d) => xScale(d.value))\n                        .attr('y', (d) => yScale(d.count))\n                        .attr('width', xScale.bandwidth())\n                        .attr('height', (d) => yScale(0) - yScale(d.count))\n                        .attr('fill', (d) => colorScale(d.value))\n                        .select('title')\n                        .text((d) => `${d.value}: ${d.count}`);\n                    });\n\n                  break;\n\n                case 'id':\n                  break;\n\n                default:\n                  console.log(`Unknown column type ${column.type}`);\n              }\n\n              // Cluster size\n              const clusterWidth = 30;\n\n              d3.select(this)\n                .select('.clusterDiv .visDiv')\n                .selectAll('svg')\n                .data([d])\n                .join('svg')\n                .attr('width', clusterWidth)\n                .attr('height', height)\n                .each(function(d) {\n                  const svg = d3.select(this);\n\n                  const height = 5;\n\n                  const size = d.isCluster ? d.size : 1;\n\n                  const xScale = d3\n                    .scaleLinear()\n                    .domain([0, maxSize])\n                    .range([0, clusterWidth]);\n\n                  // Bar\n                  svg\n                    .selectAll('rect')\n                    .data(d.expanded ? [] : [d])\n                    .join('rect')\n                    .attr('width', xScale(size))\n                    .attr('height', height)\n                    .attr('fill', '#bbb');\n                });\n            })\n            .on('mouseover', function(evt, column) {\n              table\n                .selectAll('th')\n                .filter((d) => d === column)\n                .select('.highlight')\n                .style('visibility', null);\n\n              if (visualizationMode === 'interactive') {\n                table\n                  .selectAll('td')\n                  .filter((d) => d === column || d.cluster !== null)\n                  .selectAll('.textDiv.notId')\n                  .style('visibility', null);\n              }\n\n              linkSvg\n                .selectAll('path')\n                .style('visibility', (d) =>\n                  d.source === column || d.target === column ? null : 'hidden'\n                );\n            })\n            .on('mouseout', function(evt, column) {\n              table\n                .selectAll('th')\n                .filter((d) => d === column)\n                .select('.highlight')\n                .style('visibility', (d) =>\n                  d.cluster !== null ? null : 'hidden'\n                );\n\n              if (visualizationMode === 'interactive') {\n                table\n                  .selectAll('td')\n                  .filter((d) => d === column || d.cluster !== null)\n                  .selectAll('.textDiv.notId')\n                  .style('visibility', 'hidden');\n              }\n\n              linkSvg.selectAll('path').style('visibility', null);\n            });\n        })\n        .on('mouseover', function(evt, row) {\n          table\n            .select('tbody')\n            .selectAll('tr')\n            .filter((d) => d === row)\n            .selectAll('td')\n            .classed('mouseOver', true);\n        })\n        .on('mouseout', function(evt, row) {\n          table\n            .select('tbody')\n            .selectAll('tr')\n            .filter((d) => d === row)\n            .selectAll('td')\n            .classed('mouseOver', false);\n        })\n        .on('click', function(evt, row) {\n          if (row.isCluster) {\n            row.indeces.forEach((i) => {\n              allData[i].expanded = !allData[i].expanded;\n            });\n\n            drawTable();\n          } else {\n            row.pinned = !row.pinned;\n\n            if (row.pinned) {\n              // Already shown\n              d3.select(this)\n                .selectAll('td')\n                .classed('pinned', true);\n            } else {\n              // Need to hide\n              drawTable();\n            }\n          }\n        });\n    }\n\n    function highlight() {\n      // Update border\n      const height = table.node() ? table.node().clientHeight - 4 : 0;\n\n      table\n        .selectAll('th')\n        .select('.highlight')\n        .style('height', `${height}px`)\n        .style('visibility', (d) => (d.cluster !== null ? null : 'hidden'));\n    }\n  }\n\n  function drawLinks() {\n    if (!table.node()) return;\n\n    // linkSvg.style('display', showLinks ? null : 'none');\n    // if (!showLinks) return;\n\n    // computeRelations();\n\n    if (relations.length === 0 && !isCalculating) {\n      if (window.Worker) {\n        // instantiate worker\n        isCalculating = true;\n        const computeRelationWorker = new Worker();\n\n        // post data to worker\n        computeRelationWorker.postMessage({\n          relations,\n          columns,\n          allData,\n        });\n        // if received data from worker\n        computeRelationWorker.onmessage = function(e) {\n          if (e && e.data) {\n            const { relations: re, columns: cols } = e.data;\n            relations = re;\n            columns = cols;\n            //console.log('Message received from worker');\n            isCalculating = false;\n            dispatcher_calcRel.call('CalculateRelations', this, isCalculating);\n          }\n        };\n      } else {\n        console.log(\"Your browser doesn't support web worker\");\n      }\n    }\n\n    linkSvg.style('display', showLinks ? null : 'none');\n    if (!showLinks) return;\n\n    const width = table.node().offsetWidth;\n    const height = 200;\n    const aspect = width / height;\n\n    const offset = table.node().getBoundingClientRect().x;\n\n    table\n      .selectAll('th')\n      .nodes()\n      .forEach((d, i) => {\n        const { left, right } = d.getBoundingClientRect();\n\n        columns[i].pos = left + (right - left) / 2 - offset;\n      });\n\n    relations.forEach((d) => {\n      const x1 = d.source.pos;\n      const x2 = d.target.pos;\n\n      const y = height - (x2 - x1) / aspect;\n\n      const xi = d3.interpolateNumber(x1, x2);\n      const yi = d3.interpolateNumber(height, y);\n\n      d.points = [\n        { x: xi(0), y: yi(0) },\n        { x: xi(0.1), y: yi(0.5) },\n        { x: xi(0.5), y: yi(1) },\n        { x: xi(0.9), y: yi(0.5) },\n        { x: xi(1), y: yi(0) },\n      ];\n    });\n\n    const line = d3\n      .line()\n      .x((d) => d.x)\n      .y((d) => d.y)\n      .curve(d3.curveBasis);\n\n    const colorScale = d3.scaleSequential(d3.interpolateRdBu).domain([1, -1]);\n\n    const opacityScale = d3\n      .scaleLinear()\n      .domain([0, 1])\n      .range([0, 1]);\n\n    const widthScale = d3\n      .scaleLinear()\n      .domain([0, 1])\n      .range([0, 5]);\n\n    linkSvg\n      .attr('width', width)\n      .attr('height', height)\n      .selectAll('path')\n      .data(relations)\n      .join('path')\n      .attr('d', (d) => line(d.points))\n      .style('fill', 'none')\n      .style('stroke', (d) => colorScale(d.value))\n      .style('stroke-opacity', (d) => opacityScale(d.magnitude))\n      .style('stroke-width', (d) => widthScale(d.magnitude))\n      .style('stroke-linecap', 'round')\n      .append('title')\n      .text((d) => d.value);\n  }\n\n  function applyVisualizationMode() {\n    const td = table.selectAll('td');\n    td.selectAll('.textDiv.notId').style('visibility', textVisibility());\n    td.selectAll('svg').style('visibility', visVisibility());\n  }\n\n  digestable.applySimplification = function(_) {\n    if (!arguments.length) return applySimplification;\n    applySimplification = _;\n    const clusterColumn = columns.find(({ cluster }) => cluster !== null);\n    if (clusterColumn && clusterColumn.type !== 'id') {\n      processData();\n      sortTable();\n      drawTable();\n    }\n    return digestable;\n  };\n\n  digestable.simplificationMethod = function(_) {\n    if (!arguments.length) return simplificationMethod;\n    simplificationMethod = _;\n    if (clustering) {\n      processData();\n      sortTable();\n      drawTable();\n    }\n    return digestable;\n  };\n\n  digestable.simplificationAmount = function(_) {\n    if (!arguments.length) return simplificationAmount;\n    simplificationAmount = _;\n    if (clustering) {\n      processData();\n      sortTable();\n      drawTable();\n    }\n    return digestable;\n  };\n\n  digestable.simplificationRows = function(_) {\n    if (!arguments.length) return simplificationRows;\n    simplificationRows = _;\n    if (clustering) {\n      processData();\n      sortTable();\n      drawTable();\n    }\n    return digestable;\n  };\n\n  digestable.transformBase = function(_) {\n    if (!arguments.length) return transformBase;\n    transformBase = _;\n    if (clustering) {\n      processData();\n      sortTable();\n      drawTable();\n    }\n    return digestable;\n  };\n\n  digestable.visualizationMode = function(_) {\n    if (!arguments.length) return visualizationMode;\n    visualizationMode = _;\n    applyVisualizationMode();\n    return digestable;\n  };\n\n  digestable.showLinks = function(_) {\n    if (!arguments.length) return showLinks;\n    showLinks = _;\n    drawTable();\n    return digestable;\n  };\n\n  digestable.categoryScaling = function(_) {\n    if (!arguments.length) return categoryScaling;\n    categoryScaling = _;\n    drawTable();\n    return digestable;\n  };\n\n  digestable.updateLinks = function() {\n    drawLinks();\n    return digestable;\n  };\n\n  // For registering event callbacks\n  digestable.on = function() {\n    const value = dispatcher.on.apply(dispatcher, arguments);\n    return value === dispatcher ? digestable : value;\n  };\n\n  // For registering event callbacks\n  digestable.onCalcRel = function() {\n    const value = dispatcher_calcRel.on.apply(dispatcher_calcRel, arguments);\n    return value === dispatcher_calcRel ? digestable : value;\n  };\n\n  function loadMoreData(rowNum) {\n    displayRowNum += parseInt(rowNum);\n    console.log(displayRowNum);\n    if (displayRowNum < [...allData].length) {\n      data = [...allData].slice(0, displayRowNum);\n    } else {\n      isFullData = true;\n      data = [...allData];\n    }\n    drawTable();\n  }\n\n  digestable.loadMore = function(rowNum) {\n    loadMoreData(rowNum);\n    //console.log('digestable test');\n    return digestable;\n  };\n\n  digestable.isFullData = function() {\n    return isFullData;\n  };\n\n  digestable.fullDataLength = function() {\n    return [...allData].length;\n  };\n\n  digestable.displayRowNum = function() {\n    return displayRowNum;\n  };\n\n  return digestable;\n};\n","import * as d3 from 'd3';\n\nexport const clusterQuantiles = (values, n) => {\n  const range = d3.range(n);\n\n  const scale = d3.scaleQuantile()\n    .domain(values)\n    .range(range);\n\n  return values.reduce((clusters, value, i) => {\n    clusters[scale(value)].push(i);\n    return clusters;\n  }, range.map(() => []));\n};","import * as d3 from 'd3';\n\nexport const clusterGap = (values, numRows) => {\n  const gaps = d3.pairs(values).map((d, i) => ({ value: Math.abs(d[1] - d[0]), index: i }));\n\n  gaps.sort((a, b) => {\n    return a.value === b.value ? d3.ascending(a.index, b.index) : d3.descending(a.value, b.value);\n  });\n\n  const clusters = gaps.slice(0, numRows - 1).map(gap => gap.index);\n\n  clusters.sort(d3.ascending);\n  clusters.unshift(-1);\n  clusters.push(values.length - 1);\n  \n  return d3.pairs(clusters).map(d => d3.range(d[0] + 1, d[1] + 1));\n};","export const groupCategories = values => {\n  return values.reduce((clusters, value, i, a) => {\n    if (i === 0) {\n      clusters.push([i]);\n    }\n    else {\n      if (value === a[i - 1]) {\n        clusters[clusters.length -1].push(i);\n      }\n      else {\n        clusters.push([i]);\n      }\n    }\n\n    return clusters;\n  }, []);\n}","import { Button, Form, Row, Col } from 'react-bootstrap';\nimport { useState } from 'react';\nconst Footer = ({\n  loadMore,\n  isFullData,\n  addrowNum,\n  setAddRowNum,\n  max,\n  displayRowNum,\n  refreshDisplayRowNum,\n}) => {\n  // handle form submit\n  const [displayRowNumAct, setDisplayRowNumAct] = useState(\n    displayRowNum || 100\n  );\n\n  const onFormSubmit = (e) => {\n    e.preventDefault();\n    loadMore(addrowNum);\n    if (refreshDisplayRowNum() > max) {\n      setDisplayRowNumAct(max);\n    } else {\n      setDisplayRowNumAct(refreshDisplayRowNum());\n    }\n    setAddRowNum(100);\n  };\n  return (\n    <div\n      style={{\n        padding: '2rem',\n        display: 'flex',\n        justifyContent: 'center',\n        position: 'sticky',\n        left: '0',\n        zIndex: '3',\n        backgroundColor: 'white',\n      }}\n    >\n      <Form onSubmit={onFormSubmit}>\n        <Row>\n          <Col xs='auto'>\n            <Form.Text\n              style={{ position: 'relative', top: '.5rem', fontSize: '1rem' }}\n            >\n              Showing {displayRowNumAct} of {max} rows\n            </Form.Text>\n          </Col>\n          <Col xs='auto'>\n            <Button\n              disabled={isFullData}\n              // style={{\n              //   marginLeft: '1rem',\n              // }}\n              type='submit'\n            >\n              {isFullData ? 'End of Data' : `Load ${addrowNum} more rows`}\n            </Button>\n          </Col>\n          <Col xs='auto'>\n            <Form.Control\n              //style={{ width: '8rem' }}\n              type='number'\n              //placeholder='more rows'\n              min='1'\n              max={max}\n              value={addrowNum}\n              onChange={(e) => setAddRowNum(e.target.value)}\n              disabled={isFullData}\n            />\n          </Col>\n        </Row>\n      </Form>\n    </div>\n  );\n};\nexport default Footer;\n","import { useContext, useRef, useEffect, useState } from 'react';\nimport * as d3 from 'd3';\nimport { SimplifyContext, VisualizationContext } from '../../contexts';\nimport { useScrollHook } from '../../hooks';\nimport { digestable } from '../../digestable';\nimport Footer from './Footer';\n//import { index } from 'd3';\n\nexport const TableWrapper = ({ data }) => {\n  const [\n    { apply, method, amount, rows, transformBase },\n    simplifyDispatch,\n  ] = useContext(SimplifyContext);\n  const [\n    { mode, showLinks, categoryScaling },\n    visualizationDispatch,\n  ] = useContext(VisualizationContext);\n  const divRef = useRef();\n  const digestableRef = useRef();\n  const OuterDivRef = useRef();\n\n  // parameters for load more\n  const [isFullData, setIsFullData] = useState(false);\n  const [addrowNum, setAddRowNum] = useState(100);\n  // Scroll callback\n  const onScroll = useScrollHook(\n    () => {\n      if (digestableRef.current) {\n        digestableRef.current.updateLinks();\n      }\n    },\n    OuterDivRef,\n    'horizontal'\n  );\n\n  // Create visualization\n  useEffect(() => {\n    if (!digestableRef.current) {\n      digestableRef.current = digestable()\n        .applySimplification(apply)\n        .simplificationMethod(method.name)\n        .simplificationAmount(amount)\n        .simplificationRows(rows)\n        .transformBase(transformBase)\n        .visualizationMode(mode)\n        .categoryScaling(categoryScaling)\n        .on('clusterByColumn', (column) => {\n          simplifyDispatch({\n            type: 'setColumnInfo',\n            columnType: column.type,\n            unique: column.uniqueValues.length,\n          });\n        })\n        .onCalcRel('CalculateRelations', (isCalculating) => {\n          //console.log(isCalculating);\n          visualizationDispatch({\n            type: 'setCalculatingRelations',\n            calculatingRelations: isCalculating,\n          });\n        });\n    }\n  }, []);\n\n  // Update data\n  useEffect(() => {\n    d3.select(divRef.current)\n      .datum(data)\n      .call(digestableRef.current);\n    visualizationDispatch({\n      type: 'setCalculatingRelations',\n      calculatingRelations: true,\n    });\n  }, [data]);\n\n  // Simplify parameters\n  useEffect(() => {\n    if (digestableRef.current) {\n      digestableRef.current.applySimplification(apply);\n    }\n  }, [apply]);\n\n  useEffect(() => {\n    if (digestableRef.current) {\n      digestableRef.current.simplificationMethod(method.name);\n    }\n  }, [method]);\n\n  useEffect(() => {\n    if (digestableRef.current) {\n      digestableRef.current.simplificationAmount(amount);\n    }\n  }, [amount]);\n\n  useEffect(() => {\n    if (digestableRef.current) {\n      digestableRef.current.simplificationRows(rows);\n    }\n  }, [rows]);\n\n  useEffect(() => {\n    if (digestableRef.current) {\n      digestableRef.current.transformBase(transformBase);\n    }\n  }, [transformBase]);\n\n  // Visualization parameters\n  useEffect(() => {\n    if (digestableRef.current) {\n      digestableRef.current.visualizationMode(mode);\n    }\n  }, [mode]);\n\n  useEffect(() => {\n    if (digestableRef.current) {\n      digestableRef.current.showLinks(showLinks);\n    }\n  }, [showLinks]);\n\n  useEffect(() => {\n    if (digestableRef.current) {\n      digestableRef.current.categoryScaling(categoryScaling);\n    }\n  }, [categoryScaling]);\n\n  // if still calculate relations\n  // useEffect(() => {\n  //   if (digestableRef.current) {\n  //     visualizationDispatch({\n  //       type: 'setCalculatingRelations',\n  //       calculatingRelations: false,\n  //     });\n  //   }\n  // }, [calculatingRelations]);\n\n  //load-more parameter\n\n  // initial check\n  useEffect(() => {\n    if (digestableRef.current && digestableRef.current.isFullData()) {\n      setIsFullData(true);\n    }\n  }, []);\n\n  // click event\n  const loadMore = (addrowNum) => {\n    if (digestableRef.current) {\n      digestableRef.current.loadMore(addrowNum);\n      if (digestableRef.current.isFullData()) {\n        setIsFullData(true);\n      }\n    }\n  };\n\n  const max = digestableRef.current && digestableRef.current.fullDataLength();\n  const displayRowNum =\n    digestableRef.current && digestableRef.current.displayRowNum();\n\n  const refreshDisplayRowNum = () => {\n    if (digestableRef.current) {\n      return digestableRef.current.displayRowNum();\n    }\n  };\n  return (\n    <div\n      ref={OuterDivRef}\n      onScroll={onScroll}\n      style={{\n        height: '100%',\n        overflow: 'auto',\n      }}\n    >\n      <div ref={divRef}></div>\n      {apply || isFullData ? (\n        <div></div>\n      ) : (\n        <Footer\n          loadMore={loadMore}\n          isFullData={isFullData}\n          addrowNum={addrowNum}\n          setAddRowNum={setAddRowNum}\n          max={max}\n          displayRowNum={displayRowNum}\n          refreshDisplayRowNum={refreshDisplayRowNum}\n        />\n      )}\n    </div>\n  );\n};\n","import { useRef } from 'react';\n\nexport const useScrollHook = (callback, divRef, scrollType) => {\n  const x = useRef(0);\n  const y = useRef(0);\n  const ticking = useRef(false);\n\n  return () => {\n    if (!divRef.current) return;\n\n    switch (scrollType) {\n      case 'horizontal':\n        {\n          const left = divRef.current.scrollLeft;\n\n          if (left !== x.current) {\n            x.current = left;\n\n            if (!ticking.current) {\n              window.requestAnimationFrame(() => {\n                callback(left);\n\n                ticking.current = false;\n              });\n\n              ticking.current = true;\n            }\n          }\n        }\n        break;\n\n      case 'vertical':\n        {\n          const top = divRef.current.scrollTop;\n\n          if (top !== y.current) {\n            y.current = top;\n\n            if (!ticking.current) {\n              window.requestAnimationFrame(() => {\n                callback(top);\n\n                ticking.current = false;\n              });\n\n              ticking.current = true;\n            }\n          }\n        }\n        break;\n\n      case 'both':\n        {\n          const left = divRef.current.scrollLeft;\n          const top = divRef.current.scrollTop;\n\n          if (left !== x.current || top !== y.current) {\n            x.current = left;\n            y.current = top;\n\n            if (!ticking.current) {\n              window.requestAnimationFrame(() => {\n                callback(left, top);\n\n                ticking.current = false;\n              });\n\n              ticking.current = true;\n            }\n          }\n        }\n        break;\n\n      default:\n        console.log('Invalid scroll type');\n    }\n  };\n};\n","import { Card, Stack } from 'react-bootstrap';\n\nconst { Header, Body, Subtitle } = Card;\n\nexport const ControlPanel = ({ title, subtitle, children }) => {\n  return (\n    <Card>\n      <Header>{ title }</Header>\n      <Body>\n        { subtitle && \n          <Subtitle className='mb-2 text-muted'>\n            { subtitle}\n          </Subtitle>\n        }\n        <Stack gap={ 3 }>\n          { children }\n        </Stack>\n      </Body>\n    </Card>\n  );\n};\n","import { useContext } from 'react';\nimport { Form, FloatingLabel } from 'react-bootstrap';\nimport { SimplifyContext } from '../../contexts';\nimport { ControlPanel } from './controlPanel';\n\nconst { Group, Label, Check, Select, Range, Control } = Form;\n\nexport const SimplifyControls = () => {\n  const [\n    { apply, columnType, methods, method, amount, transformBase, unique, rows },\n    simplifyDispatch,\n  ] = useContext(SimplifyContext);\n\n  const onApplyChange = (evt) => {\n    simplifyDispatch({ type: 'setApply', apply: evt.target.checked });\n  };\n\n  const onMethodChange = (evt) => {\n    simplifyDispatch({\n      type: 'setMethod',\n      method: methods.find(({ name }) => name === evt.target.value),\n    });\n  };\n\n  const onAmountChange = (evt) => {\n    simplifyDispatch({ type: 'setAmount', amount: +evt.target.value / 100 });\n  };\n\n  const onRowsChange = (evt) => {\n    simplifyDispatch({ type: 'setRows', rows: +evt.target.value });\n  };\n\n  const onTransformBaseChange = (evt) => {\n    simplifyDispatch({\n      type: 'setTransformBase',\n      transformBase: +evt.target.value / 100,\n    });\n  };\n\n  return (\n    <ControlPanel title='Simplification' subtitle={`${columnType} column`}>\n      <Group>\n        <Check\n          type='checkbox'\n          label='Apply'\n          id='apply-simplification-checkbox'\n          size='sm'\n          checked={apply}\n          disabled={columnType === 'id'}\n          onChange={onApplyChange}\n        />\n      </Group>\n      {columnType === 'numeric' && (\n        <>\n          <Group>\n            <Label>numeric column:</Label>\n            <FloatingLabel label='Method'>\n              <Select value={method.name} onChange={onMethodChange}>\n                {methods.map(({ name }, i) => (\n                  <option key={i} value={name}>\n                    {name}\n                  </option>\n                ))}\n              </Select>\n            </FloatingLabel>\n          </Group>\n          {method.type === 'amount' ? (\n            <Group>\n              <Label>Amount</Label>\n              <Range\n                min={0}\n                max={100}\n                step={1}\n                value={amount * 100}\n                onChange={onAmountChange}\n              />\n            </Group>\n          ) : (\n            <Group>\n              <Label>Number of rows</Label>\n              <Control\n                type='number'\n                min={1}\n                max={unique}\n                step={1}\n                value={rows}\n                onChange={onRowsChange}\n              />\n            </Group>\n          )}\n          {method.transform && (\n            <Group>\n              <Label>Depth weight</Label>\n              <Range\n                min={100}\n                max={400}\n                step={1}\n                value={transformBase * 100}\n                onChange={onTransformBaseChange}\n              />\n            </Group>\n          )}\n        </>\n      )}\n    </ControlPanel>\n  );\n};\n","import { useContext } from 'react';\nimport { Form, FloatingLabel, Spinner, Row, Col } from 'react-bootstrap';\nimport { VisualizationContext } from '../../contexts';\nimport { ControlPanel } from './controlPanel';\n\nconst { Group, Select, Check } = Form;\n\nexport const VisualizationControls = () => {\n  const [\n    {\n      modes,\n      mode,\n      showLinks,\n      categoryScalingOptions,\n      categoryScaling,\n      calculatingRelations,\n    },\n    visualizationDispatch,\n  ] = useContext(VisualizationContext);\n\n  const onModeChange = (evt) => {\n    visualizationDispatch({ type: 'setMode', mode: evt.target.value });\n  };\n\n  const onShowLinksChange = (evt) => {\n    visualizationDispatch({\n      type: 'setShowLinks',\n      showLinks: evt.target.checked,\n    });\n  };\n\n  const onCategoryScalingChange = (evt) => {\n    visualizationDispatch({\n      type: 'setCategoryScaling',\n      categoryScaling: evt.target.value,\n    });\n  };\n\n  return (\n    <ControlPanel title='Visualization'>\n      <Group>\n        <FloatingLabel label='Mode'>\n          <Select value={mode} onChange={onModeChange}>\n            {modes.map((mode, i) => (\n              <option key={i} value={mode}>\n                {mode}\n              </option>\n            ))}\n          </Select>\n        </FloatingLabel>\n      </Group>\n      <Group>\n        {calculatingRelations ? (\n          <>\n            <Check\n              type='checkbox'\n              label='Show links'\n              id='show-links-checkbox'\n              size='sm'\n              checked={showLinks}\n              onChange={onShowLinksChange}\n              disabled={calculatingRelations}\n            />\n            {/* <Spinner\n                animation='border'\n                style={{\n                  width: '1.5rem',\n                  height: '1.5rem',\n                  position: 'relative',\n                  right: '20%',\n                }}\n              /> */}\n            <p className='text-muted small' style={{ marginBottom: '0rem' }}>\n              Calculating...\n            </p>\n          </>\n        ) : (\n          <Check\n            type='checkbox'\n            label='Show links'\n            id='show-links-checkbox'\n            size='sm'\n            checked={showLinks}\n            onChange={onShowLinksChange}\n            disabled={calculatingRelations}\n          />\n        )}\n      </Group>\n      <Group>\n        <FloatingLabel label='Category scaling'>\n          <Select value={categoryScaling} onChange={onCategoryScalingChange}>\n            {categoryScalingOptions.map((option, i) => (\n              <option key={i} value={option}>\n                {option}\n              </option>\n            ))}\n          </Select>\n        </FloatingLabel>\n      </Group>\n    </ControlPanel>\n  );\n};\n","import { useState } from 'react';\nimport {\n  Container,\n  Navbar,\n  Row,\n  Col,\n  Form,\n  Spinner,\n  Stack,\n} from 'react-bootstrap';\nimport * as d3 from 'd3';\nimport { SimplifyProvider, VisualizationProvider } from './contexts';\nimport { TableWrapper } from './components/table-wrapper';\nimport { SimplifyControls, VisualizationControls } from './components/controls';\n\nconst { Brand } = Navbar;\nconst { Group, Control, Select } = Form;\n\nconst datasets = [\n  { name: 'MT Cars', url: '/digestable/data/mtcars.csv' },\n  { name: 'NFL Combine 2017', url: '/digestable/data/NFL Combine 2017.csv' },\n];\n\nexport const App = () => {\n  const [dataset, setDataset] = useState('');\n  const [data, setData] = useState(null);\n  const [loading, setLoading] = useState(false);\n\n  // XXX: Add loading spinner\n  const loadData = async (url) => {\n    setData(null);\n    setLoading(true);\n\n    try {\n      const csvData = await d3.csv(url);\n\n      setData(csvData);\n      setLoading(false);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const onSelectChange = (evt) => {\n    const url = evt.target.value;\n\n    setDataset(url);\n    loadData(url);\n  };\n\n  const onFileSelect = (evt) => {\n    const file = evt.target.files.length === 1 ? evt.target.files[0] : null;\n\n    if (file) {\n      setDataset('');\n      loadData(URL.createObjectURL(file));\n    }\n  };\n  // Get the query string\n  const queryParams = new URLSearchParams(window.location.search);\n  const mode = queryParams.get('mode');\n\n  return (\n    <SimplifyProvider>\n      <VisualizationProvider>\n        <Navbar bg='dark' variant='dark'>\n          <Brand className='ms-2'>\n            <img\n              src='/digestable/digestable_512.png'\n              alt='digestable logo'\n              height='32px'\n              className='me-1'\n            />\n            <span className='text-align-bottom'>\n              diges<b>table</b>\n            </span>\n          </Brand>\n          <Form>\n            <Group as={Row} className='align-items-center'>\n              <Col>\n                <Select value={dataset} onChange={onSelectChange}>\n                  <option value='' disabled>\n                    Choose dataset\n                  </option>\n                  {datasets.map((dataset, i) => (\n                    <option key={i} value={dataset.url}>\n                      {dataset.name}\n                    </option>\n                  ))}\n                </Select>\n              </Col>\n              <Col sm='auto' className='text-center'>\n                <span className='text-light'>or</span>\n              </Col>\n              <Col>\n                <Control type='file' accept='.csv' onChange={onFileSelect} />\n              </Col>\n            </Group>\n          </Form>\n        </Navbar>\n        {data ? (\n          <Container fluid style={{ height: 'calc(100% - 100px)' }}>\n            <Row style={{ height: '100%' }}>\n              <Col xs={10} className='mt-3' style={{ height: '100%' }}>\n                <TableWrapper data={data} />\n              </Col>\n              <Col className='bg-dark'>\n                {mode === 'simple' ? (\n                  <Stack gap={3}></Stack>\n                ) : (\n                  <Stack gap={3}>\n                    <SimplifyControls />\n                    <VisualizationControls />\n                  </Stack>\n                )}\n              </Col>\n            </Row>\n          </Container>\n        ) : (\n          <Container>\n            <div className='m-4 text-center'>\n              {loading ? (\n                <>\n                  <h5>Loading...</h5>\n                  <Spinner animation='border' />\n                </>\n              ) : (\n                <h3>No data</h3>\n              )}\n            </div>\n          </Container>\n        )}\n      </VisualizationProvider>\n    </SimplifyProvider>\n  );\n};\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport { App } from './app';\n//import reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n//reportWebVitals();\n"],"sourceRoot":""}